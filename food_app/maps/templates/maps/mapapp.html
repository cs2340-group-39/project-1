<!DOCTYPE html>
<html>
<head>
    <title>Google Maps with Search</title>
    <style>
        /* Set the size of the map and search bar */
        #map {
            height: 500px;  /* Adjust height as needed */
            width: 100%;    /* Adjust width as needed */
        }
        #search-box {
            margin: 10px;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>
<h1>Google Maps Search</h1>
<!-- Search bar for places -->
<input id="search-box" type="text" placeholder="Search for places...">

<!-- The map will be rendered here -->
<div id="map"></div>

<!-- Load the Google Maps JavaScript API with Places Library -->
<script src="https://maps.googleapis.com/maps/api/js?key={{ api_key }}&libraries=places"></script>
<script>
    function initMap() {
        // Define the map options
        var mapOptions = {
            zoom: 8
        };

        // Create a new map
        var map = new google.maps.Map(document.getElementById('map'), mapOptions);

        // Create a new PlacesAutocomplete instance
        var input = document.getElementById('search-box');
        var autocomplete = new google.maps.places.Autocomplete(input);

        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                var userLocation = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };

                // Set the map's center to the user's location
                map.setCenter(userLocation);
            })
        } else {
            // Browser doesn't support Geolocation
            handleLocationError(false, map.getCenter());
        }

        function handleLocationError(browserHasGeolocation, pos) {
            var infoWindow = new google.maps.InfoWindow({
                map: map,
                position: pos,
                content: browserHasGeolocation ?
                    'Error: The Geolocation service failed.' :
                    'Error: Your browser doesn\'t support geolocation.'
            });
        }

            // Bind the autocomplete object to the map and the search box
        autocomplete.bindTo('bounds', map);

        // Add an event listener to handle the place selection
        autocomplete.addListener('place_changed', function() {
            var place = autocomplete.getPlace();

            if (!place.geometry) {
                // User entered the name of a Place that was not suggested and pressed the Enter key
                alert("No details available for input: '" + place.name + "'");
                return;
            }

            // If the place has a geometry, then present it on a map
            if (place.geometry.viewport) {
                map.fitBounds(place.geometry.viewport);
            } else {
                map.setCenter(place.geometry.location);
                map.setZoom(17);  // Why 17? Because it looks good.
            }

            // Add a marker at the selected place
            var marker = new google.maps.Marker({
                map: map,
                position: place.geometry.location
            });

            // Optionally, add an info window to display the place's name
            var infoWindow = new google.maps.InfoWindow({
                content: place.name
            });
            infoWindow.open(map, marker);
        });
    }

    // Initialize the map when the window loads
    window.onload = initMap;
</script>
</body>
</html>
